#!/bin/zsh
#
# Copy home directory template files to the user's home directory and
# initialize it as a Git repository.

source "$HOMER_PATH/share/homer/cli.zsh"

if [ -z $HOMER_PREFIX ]; then
  export HOMER_PREFIX="/usr/local"
fi

HOMER_PATH=$2

if [ -z $HOMER_PATH ]; then
  HOMER_PATH=$HOME
fi

if [[ -e "$HOMER_PATH/.git" ]]; then
  echo "There is already an existing Git repository in your home directory."
  exit 0
fi

zparseopts -K -- m:=message c:=repository

if [ -z $message ]; then
  message="Initialize home directory."
fi

if [[ -n "${repository+}" ]]; then
  git clone $repository /tmp/home-directory
  cp -a /tmp/home-directory/** $HOMER_PATH
  cp -a /tmp/home-directory/.* $HOMER_PATH
  rm -rf /tmp/home-directory
else
  git init $HOMER_PATH
  cp -a $HOMER_PREFIX/share/homer/template/** $HOMER_PATH
  cp -a $HOMER_PREFIX/share/homer/template/.* $HOMER_PATH
  homer_add_all $message
fi

