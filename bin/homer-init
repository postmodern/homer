#!/bin/zsh
#
# Copy home directory template files to the user's home directory and
# initialize it as a Git repository.

# Override $HOMER_HOME with the first argument to homer init if given.
if [ ! -z "$2" ]; then
  HOMER_HOME=$2
fi

source "$HOMER_PATH/share/homer/cli.zsh"

if [[ -e "$HOMER_HOME/.git" ]]; then
  homer_error "There is already an existing Git repository in $HOMER_HOME."
  exit 0
fi

zparseopts -K -- m:=message c:=repository

if [ -z $message ]; then
  message="Initialize home directory."
fi

if [[ -n "${repository+}" ]]; then
  git clone $repository /tmp/home-directory
  cp -a /tmp/home-directory/** $HOMER_HOME
  cp -a /tmp/home-directory/.* $HOMER_HOME
  rm -rf /tmp/home-directory
else
  git init $HOMER_HOME
  cp -a $HOMER_PREFIX/share/homer/template/** $HOMER_HOME
  cp -a $HOMER_PREFIX/share/homer/template/.* $HOMER_HOME
  homer_add_all $message
fi

for tap in `cat $HOMER_HOME/etc/brew/taps`; do
  brew tap $tap
done

brew update

for package in `cat $HOMER_HOME/etc/brew/packages`; do
  brew install $package
done

for cask in `cat $HOMER_HOME/etc/brew/casks`; do
  brew cask install $cask
done
