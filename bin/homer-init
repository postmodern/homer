#!/bin/zsh
#
# Copy home directory template files to the user's home directory and
# initialize it as a Git repository.

if [ -z $PREFIX ]; then
  export PREFIX="/usr/local/"
fi

dir=$2

if [ -z $dir ]; then
  dir=$HOME
fi

source "$PREFIX/share/homer/git.zsh"

if [[ -e "$dir/.git" ]]; then
  echo "There is already an existing repo in your home dir."
  exit 0
fi

zparseopts -K -- m:=message c:=repository

if [ -z $message ]; then
  message="Initialize home directory."
fi

if [[ -n "${repository+}" ]]; then
  git clone $repository /tmp/home-directory
  cp -a /tmp/home-directory/** $dir
  cp -a /tmp/home-directory/.* $dir
  rm -rf /tmp/home-directory
else
  git init $dir
  cp -a $PREFIX/share/homer/template/** $dir
  cp -a $PREFIX/share/homer/template/.* $dir
  homer_add_all $message
fi

